SET documentdb.next_collection_id TO 173000;
SET documentdb.next_collection_index_id TO 173000;
SET search_path TO documentdb_api, documentdb_api_catalog,documentdb_core;
-- test some negative cases for killOp
-- Valid op field is an id and is a combination of <shardid>:<operationId>
SELECT documentdb_api.kill_op(NULL);
 kill_op 
---------
 
(1 row)

SELECT documentdb_api.kill_op('{}');
ERROR:  Did not provide "op" field
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "12345" }');
ERROR:  The op argument to killOp must be of the format shardid:opid but found 12345
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "12345:" }');
ERROR:  The op argument to killOp must be of the format shardid:opid but found 12345:
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": ":" }');
ERROR:  The op argument to killOp must be of the format shardid:opid but found :
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "" }');
ERROR:  The op field in killOp cannot be empty
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": ":12345" }');
ERROR:  The op argument to killOp must be of the format shardid:opid but found :12345
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "foo:baar" }');
ERROR:  Invalid shardId: foo
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "12345:1234C5" }');
ERROR:  Invalid opId: 1234C5
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "10000000001:12345" }'); -- No databse specified
ERROR:  killOp may only be run against the admin database.
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "10000000001:12345", "$db": "test" }'); -- Valid but not against admin db
ERROR:  killOp may only be run against the admin database.
-- Valid but no-ops
SELECT documentdb_api.kill_op('{ "killOp": 1, "op": "10000004122:12345", "$db": "admin" }');
                                              kill_op                                              
---------------------------------------------------------------------------------------------------
 { "shard" : "shard1", "shardid" : { "$numberInt" : "4122" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

